version: "1"

package:
  id: org.deepin.movie
  name: deepin-movie-reborn
  version: 6.0.7.7
  kind: app
  description: |
    movie player Movie is a full-featured video player, supporting playing local and streaming media in multiple video formats.

base: org.deepin.foundation/20.0.0
runtime: org.deepin.Runtime/20.0.0

source:
  - kind: local
    name: deepin-movie-reborn

command:
  - "/opt/apps/org.deepin.movie/files/bin/start.sh"

build: |
  export TRIPLET="x86_64-linux-gnu"
  ./build2.sh pkgs $PREFIX
  export PATH=$PREFIX/bin:$PATH
  export PKG_CONFIG_PATH=$PREFIX/lib/x86_64-linux-gnu/pkgconfig:/runtime/lib/x86_64-linux-gnu/pkgconfig:$PKG_CONFIG_PATH
  export LIBRARY_PATH=$PREFIX/lib/x86_64-linux-gnu:/runtime/lib/x86_64-linux-gnu:$LIBRARY_PATH
  export LD_LIBRARY_PATH=$PREFIX/lib/x86_64-linux-gnu:/runtime/lib/x86_64-linux-gnu:$LD_LIBRARY_PATH
  export C_INCLUDE_PATH=$PREFIX/include:$PREFIX/include/x86_64-linux-gnu
  export CPLUS_INCLUDE_PATH=$PREFIX/include/c++/13:$C_INCLUDE_PATH
  export DISPLAY=:0
  mv $PREFIX/lib/x86_64-linux-gnu/pulseaudio/* $PREFIX/lib/x86_64-linux-gnu
  cmake -B build -DCMAKE_INSTALL_PREFIX=${PREFIX} -DCMAKE_INSTALL_LIBDIR=${PREFIX}/lib/${TRIPLET}
  cmake --build build -- -j${JOBS}
  cmake --build build --target install
  echo "#!/usr/bin/env bash" > start.sh
  echo "export LD_LIBRARY_PATH=/opt/apps/org.deepin.movie/files/lib/x86_64-linux-gnu:$LD_LIBRARY_PATH" >> start.sh
  echo "cd $PREFIX/bin && ./deepin-movie \$@" >> start.sh
  install -m 0755 start.sh $PREFIX/bin

