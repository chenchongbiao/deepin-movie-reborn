version: "1"

package:
  id: org.deepin.movie
  name: deepin-movie-reborn
  version: 6.0.7.8
  kind: app
  description: |
    movie player Movie is a full-featured video player, supporting playing local and streaming media in multiple video formats.

base: org.deepin.foundation/20.0.0
runtime: org.deepin.Runtime/20.0.0

command:
  - /opt/apps/org.deepin.movie/files/bin/start.sh

source:
  - kind: local
    name: deepin-movie-reborn

build: |
  export TRIPLET="x86_64-linux-gnu"
  export PATH=$PATH:/usr/libexec/linglong/builder/helper
  install_dep pkgs $PREFIX
  export PKG_CONFIG_PATH=$PREFIX/lib/${TRIPLET}/pkgconfig:/runtime/lib/${TRIPLET}/pkgconfig:$PKG_CONFIG_PATH
  export LIBRARY_PATH=$PREFIX/lib/${TRIPLET}:/runtime/lib/${TRIPLET}:$LIBRARY_PATH
  export LD_LIBRARY_PATH=$PREFIX/lib/${TRIPLET}:/runtime/lib/${TRIPLET}:$LD_LIBRARY_PATH
  export C_INCLUDE_PATH=$PREFIX/include:$PREFIX/include/${TRIPLET}
  export CPLUS_INCLUDE_PATH=$PREFIX/include/c++/13:$C_INCLUDE_PATH
  # export DISPLAY=:0
  mv $PREFIX/lib/${TRIPLET}/pulseaudio/* $PREFIX/lib/${TRIPLET}
  cmake -B build -DCMAKE_INSTALL_PREFIX=${PREFIX} -DCMAKE_INSTALL_LIBDIR=${PREFIX}/lib/${TRIPLET}
  cmake --build build -- -j${JOBS}
  cmake --build build --target install
  echo "#!/usr/bin/env bash" > start.sh
  echo "export LD_LIBRARY_PATH=/opt/apps/org.deepin.movie/files/lib/${TRIPLET}:$LD_LIBRARY_PATH" >> start.sh
  echo "export QT_QPA_PLATFORM_PLUGIN_PATH=/runtime/lib/loongarch64-linux-gnu/qt5/plugins/platforms" >> start.sh
  echo "export QT_PLUGIN_PATH=/runtime/lib/loongarch64-linux-gnu/qt5/plugins" >> start.sh
  echo "cd $PREFIX/bin && ./deepin-movie \$@" >> start.sh
  install -m 0755 start.sh $PREFIX/bin
